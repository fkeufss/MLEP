# MLEP: Multi-granularity Local Entropy Patterns for Generalized Al-generated lmage Detection
Official github repository for the article [MLEP: Multi-granularity Local Entropy Patterns for Generalized Al-generated lmage Detection](https://arxiv.org/abs/2504.13726), which was accepted by NeurIPS 2025.

<p align="center"><img src="./MLEP.png" width="100%" alt="overall pipeline"></p>

<p align="center">
    <strong>Lin Yuan, Xiaowan Li, Yan Zhang<sup>*</sup>, Jiawei Zhang, Hongbo Li, Xinbo Gao<sup>*</sup></strong>
</p>
<p align="center">
    <strong>Chongqing Key Laboratory of Image Cognition, Chongqing University of Posts and Telecommunications</strong>
</p>

<p align="center">
    <a href='https://arxiv.org/abs/2504.13726'>
      <img src='https://img.shields.io/badge/arXiv-PDF-green?style=flat&logo=arXiv&logoColor=green' alt='arXiv PDF'>
         </a>
    
## Environment Setup
```sh
conda env create -f environment.yaml
```
Due to the large number of environment packages, the "solving environment" step of creating environment may be time-consuming.

## Getting the  Datasets
### Test Datasets
The test datasets we use can all be found at [NPR 2024 CVPR](https://github.com/chuangchuangtan/NPR-DeepfakeDetection).
You can also create your own dataset to test, just follow a similar folder structure below, and modify the dataroot in 'test.py'.

### Train Datasets
We use the same training dataset as NPR, which includes four types of images (car, cat, chair, horse) generated by ProGAN. The specific dataset can be obtained at [NPR 2024 CVPR](https://github.com/chuangchuangtan/NPR-DeepfakeDetection).

## Directory structure
<details>
<summary> Click to expand the folder tree structure. </summary>

```
datasets
|-- TrainDatasets
|   |-- train
|   |-- val
|   `-- test
`-- TestDatasets
    |-- GAN-set-1        # Set1
    |   |-- biggan
    |   |-- cyclegan
    |   |-- gaugan
    |   |-- progan
    |   |-- stargan
    |   |-- stylegan
    |   `-- stylegan2
    |-- GAN-set-2        # Set2
    |   |-- AttGAN
    |   |-- BEGAN
    |   |-- CramerGAN
    |   |-- InfoMaxGAN
    |   |-- MMDGAN
    |   |-- RelGAN
    |   |-- S3GAN
    |   |-- SNGAN
    |   `-- STGAN
    `-- Diffusion-set    # Set3
        |-- adm
        |-- DALLE
        |-- dalle_mini
        |-- ddpm
        |-- glide_100_10
        |-- glide_100_27
        |-- glide_50_27
        |-- iddpm
        |-- ldm
        |-- ldm_200
        |-- ldm_200_cfg
        |-- midjourney
        |-- pndm
        |-- sdv1_new
        |-- sdv2
        `-- vqdiffusion

```
</details>

Further down are the '0_real' and '1_fake' folders.

## Training
Download the training datasets and modify the dataroot:
```sh
python train.py --name 4class-resnet50 --dataroot /Data/MLEP/datasets/TrainDatasets --classes car,cat,chair,horse --batch_size 32 --delr_freq 10 --lr 0.0002 --niter 100
```
## Testing

Download the testing datasets and modify the dataroot in 'test.py', and then run:
```sh
python test.py --model_path ./pretrained/model_epoch_best.pth --batch_size 64
```

## Acknowledgements
Our code is developed based on [CNNDet 2020 CVPR](https://github.com/peterwang512/CNNDetection), [NPR 2024 CVPR](https://github.com/chuangchuangtan/NPR-DeepfakeDetection). Thanks for their sharing codes and models.
